<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transportes Masic - DEBUG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        input, select, textarea { font-size: 16px !important; }
        #debug { 
            position: fixed; 
            bottom: 0; 
            left: 0; 
            right: 0; 
            background: black; 
            color: lime; 
            padding: 10px; 
            font-family: monospace; 
            font-size: 12px; 
            max-height: 200px; 
            overflow-y: auto;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app"></div>
    <div id="debug"></div>

    <script>
        const SCRIPT_URL = "PEGA_AQUI_TU_URL_COMPLETA";
        
        const CONFIG = {
            empresa: "Transportes Masic Spa",
            iva: 0.19,
            tiposServicio: [
                { codigo: "SRV001", nombre: "Traslado Aeropuerto" },
                { codigo: "SRV002", nombre: "Tour Tur√≠stico" },
                { codigo: "SRV003", nombre: "Transporte Empresarial" },
                { codigo: "SRV004", nombre: "Evento Privado" },
                { codigo: "SRV005", nombre: "Transporte Escolar" },
                { codigo: "SRV006", nombre: "Servicio Mensual" },
                { codigo: "SRV999", nombre: "Otro" }
            ],
            categoriasGastos: [
                { codigo: "GAS001", nombre: "Combustible" },
                { codigo: "GAS002", nombre: "Mantenimiento" },
                { codigo: "GAS003", nombre: "Neum√°ticos" },
                { codigo: "GAS004", nombre: "Repuestos" },
                { codigo: "GAS005", nombre: "Seguros" },
                { codigo: "GAS006", nombre: "TAG/Peajes" },
                { codigo: "GAS007", nombre: "Permiso Circulaci√≥n" },
                { codigo: "GAS008", nombre: "Revisi√≥n T√©cnica" },
                { codigo: "GAS009", nombre: "Remuneraciones" },
                { codigo: "GAS010", nombre: "Leyes Sociales" },
                { codigo: "GAS011", nombre: "Honorarios" },
                { codigo: "GAS012", nombre: "Arriendo Oficina" },
                { codigo: "GAS013", nombre: "Servicios B√°sicos" },
                { codigo: "GAS014", nombre: "Telefon√≠a/Internet" },
                { codigo: "GAS015", nombre: "Publicidad" },
                { codigo: "GAS016", nombre: "√ötiles Oficina/Limpieza" },
                { codigo: "GAS017", nombre: "Contador/Asesor√≠a" },
                { codigo: "GAS018", nombre: "Multas" },
                { codigo: "GAS999", nombre: "Otros Gastos" }
            ],
            formasPago: [
                { codigo: "PAG001", nombre: "Efectivo" },
                { codigo: "PAG002", nombre: "Transferencia" },
                { codigo: "PAG003", nombre: "Cheque" },
                { codigo: "PAG004", nombre: "Tarjeta D√©bito" },
                { codigo: "PAG005", nombre: "Tarjeta Cr√©dito" },
                { codigo: "PAG006", nombre: "Factura 30 d√≠as" },
                { codigo: "PAG007", nombre: "Factura 60 d√≠as" },
                { codigo: "PAG008", nombre: "Tarjeta Cr√©dito Personal" },
                { codigo: "PAG009", nombre: "Tarjeta Cr√©dito Empresa" },
                { codigo: "PAG010", nombre: "Tarjeta D√©bito Personal" },
                { codigo: "PAG011", nombre: "Tarjeta D√©bito Empresa" }
            ]
        };

        let vehiculos = [
            { Patente: "ABCD12", Marca: "Mercedes", Modelo: "Sprinter" },
            { Patente: "EFGH34", Marca: "Hyundai", Modelo: "H1" },
            { Patente: "IJKL56", Marca: "Toyota", Modelo: "Hiace" }
        ];
        
        let clientes = [
            { RazonSocial: "Hotel Puerto Varas" },
            { RazonSocial: "Empresa Turismo Sur" },
            { RazonSocial: "Colegio Los Lagos" },
            { RazonSocial: "Cliente VIP" }
        ];
        
        let conductores = [
            { Nombre: "Cristi√°n Masic" },
            { Nombre: "Alberto Conductor" }
        ];

        let currentView = 'servicio';

        function log(msg) {
            const debug = document.getElementById('debug');
            const timestamp = new Date().toLocaleTimeString();
            debug.innerHTML += `[${timestamp}] ${msg}<br>`;
            debug.scrollTop = debug.scrollHeight;
            console.log(msg);
        }

        function render() {
            const app = document.getElementById('app');
            app.innerHTML = renderFormServicio();
            setTimeout(() => lucide.createIcons(), 10);
        }

        function renderFormServicio() {
            return `
                <div class="min-h-screen bg-gray-50 pb-52">
                    <div class="bg-blue-600 text-white p-4 shadow-lg">
                        <h1 class="text-xl font-bold">üîç DEBUG MODE - Registrar Servicio</h1>
                        <p class="text-sm">Mira el panel negro abajo para ver qu√© est√° pasando</p>
                    </div>

                    <div class="p-4">
                        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4">
                            <p class="text-sm"><strong>URL del Script:</strong></p>
                            <p class="text-xs font-mono break-all">${SCRIPT_URL}</p>
                        </div>

                        <form id="formServicio" onsubmit="guardarServicio(event)" class="bg-white rounded-xl p-6 shadow-lg space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Cliente *</label>
                                <select name="cliente" required class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                    <option value="">Selecciona</option>
                                    ${clientes.map(c => `<option value="${c.RazonSocial}">${c.RazonSocial}</option>`).join('')}
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Veh√≠culo *</label>
                                <select name="vehiculo" required class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                    <option value="">Selecciona</option>
                                    ${vehiculos.map(v => `<option value="${v.Patente}">${v.Patente} - ${v.Marca} ${v.Modelo}</option>`).join('')}
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Conductor</label>
                                <select name="conductor" class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                    <option value="">Selecciona</option>
                                    ${conductores.map(c => `<option value="${c.Nombre}">${c.Nombre}</option>`).join('')}
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Servicio *</label>
                                <select name="tipoServicio" required class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                    <option value="">Selecciona</option>
                                    ${CONFIG.tiposServicio.map(t => `<option value="${t.codigo}">${t.nombre}</option>`).join('')}
                                </select>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Origen</label>
                                    <input type="text" name="origen" class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Destino</label>
                                    <input type="text" name="destino" class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Km</label>
                                    <input type="number" name="km" class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Pasajeros</label>
                                    <input type="number" name="pasajeros" class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Monto *</label>
                                <input type="number" name="monto" required class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Forma de Pago *</label>
                                <select name="formaPago" required class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                    <option value="">Selecciona</option>
                                    ${CONFIG.formasPago.map(f => `<option value="${f.codigo}">${f.nombre}</option>`).join('')}
                                </select>
                            </div>

                            <button type="submit" class="w-full bg-blue-600 text-white py-4 rounded-lg font-semibold shadow-lg hover:bg-blue-700">
                                üöÄ Guardar Servicio (modo debug)
                            </button>
                        </form>
                    </div>
                </div>
            `;
        }

        async function guardarServicio(e) {
            e.preventDefault();
            log('üìù Formulario enviado');
            
            const form = e.target;
            const formData = new FormData(form);
            const data = Object.fromEntries(formData);
            
            log('üìä Datos del formulario:');
            log(JSON.stringify(data, null, 2));
            
            if (SCRIPT_URL === "https://script.google.com/macros/s/AKfycbyGBwFkbRP-y6K_qD1plEgfOlCm__ePaOZ8WZxCXCQcFyewkZy-RkvlKjyvizP1Mkua/exec") {
                log('‚ùå ERROR: URL no configurada');
                alert('ERROR: Por favor configura la URL del Google Apps Script en el c√≥digo');
                return;
            }
            
            log('üåê Enviando a: ' + SCRIPT_URL);
            
            const payload = {
                action: 'registrarServicio',
                data: data
            };
            
            log('üì¶ Payload: ' + JSON.stringify(payload));
            
            try {
                log('‚è≥ Enviando petici√≥n POST...');
                
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain'
                    },
                    body: JSON.stringify(payload)
                });
                
                log('‚úÖ Respuesta recibida. Status: ' + response.status);
                
                const result = await response.json();
                log('üì® Resultado: ' + JSON.stringify(result));
                
                if (result.success) {
                    log('üéâ ¬°√âXITO! Servicio registrado: ' + result.idServicio);
                    alert('‚úÖ Servicio registrado exitosamente: ' + result.idServicio + '\n\nVerifica tu Google Sheet');
                    form.reset();
                } else {
                    log('‚ùå Error del servidor: ' + result.error);
                    alert('Error: ' + result.error);
                }
                
            } catch (error) {
                log('üí• ERROR de conexi√≥n: ' + error.toString());
                alert('Error de conexi√≥n: ' + error.message + '\n\nRevisa el panel de debug (abajo)');
            }
        }

        // Iniciar
        log('üöÄ App iniciada');
        log('üìç URL configurada: ' + (SCRIPT_URL !== "https://script.google.com/macros/s/AKfycbyGBwFkbRP-y6K_qD1plEgfOlCm__ePaOZ8WZxCXCQcFyewkZy-RkvlKjyvizP1Mkua/exec" ? "S√ç ‚úÖ" : "NO ‚ùå"));
        render();
    </script>
</body>
</html>
